---
title: "Relationship Between Sustainability (SDI) and GDP per Capita"
author: "Karisa Kopecek, Theo Sprouse, Treasure Joyce & Brooke Wallasch"
format: 
  html:
    embed-resources: true
    code-tools: true
    toc: true
    html-table-processing: none
    code-fold: true
editor: source
execute: 
  error: true
  echo: true
  message: false
  warning: false
---

# Introduction

We were interested in investigating the relationship between gross domestic product (GDP) and the sustainable development index (SDI). GDP is a metric that provides a monetary sum of the services and goods outputted from a country per person (https://www.focus-economics.com/economic-indicator/gdp-per-capita/). SDI measures how efficient a countries developments are (https://www.sustainabledevelopmentindex.org/). Before forming a hypothesis about the relationship between these two variables, we investigated development in different countries. We found that some of the leading countries in sustainability efforts across governance, environmental and social companies include Denmark, Finland, Sweden and Norway which are all countries that are developed countries versus some of the lowest being Burkina Faso, Guinea, and Ethiopia which are developing nations (https://www.robeco.com/en-us/sustainable-investing/expertise/most-sustainable-countries-in-the-world). We found a sector of research investigating the relationship between the rich and climate change and how they are leading to rapid climate change (Paddison, 2021). Additionally, this stemmed into articles discussing whether the rich have a responsibility to pay for their impact on climate change (Gharib, 2021). Additionally, there is a larger gap in sustainability efforts of richer countries compared to poorer countries (Sexton, 2023). Overall, we were motivated to see whether richer countries do actually receive higher sustainability scores.

For these reasons and due to our preliminary research that we conducted we hypothesized that countries with higher GDP will have higher sustainability scores. Additionally, we hypothesized that there is a positive correlation between country wealth and sustainability score of countries.

After completing this report we hope to provide an analysis of the relationship between GDP and sustainability scores across different countries , evaluate outliers in the data, an ultimately asses whether sustainability outcomes are better or worse depending on a country's GDP.

## Packages

```{r}
library(tidyverse)
library(knitr)
library(kableExtra)
library(gganimate) 
library(broom) 
library(scales) #for formatting p-values
```

## Data

We extracted two datasets from GapMinder on May 20, 2025. The first dataset is where the GDP per Capita was sourced from. The explanatory variable we were interested in is GDP per Capita (<http://gapm.io/dgdpcap_cppp>) from 1800-2022. For 1990-2022, the series aligns with the World Bank’s GDP per capita data (<https://data.worldbank.org/indicator/NY.GDP.PCAP.PP.KD>), published in April 2024. Prior to 1990, data is drawn from the 2023 version of the Maddison Project Database (<https://www.rug.nl/ggdc/historicaldevelopment/maddison/releases/maddison-project-database-2023>), which offers historical GDP estimates for 169 countries. In rare cases where neither source provided data (typically between 1950-2019) Gapminder uses the Penn World Table (PWT) version 10.01 (<https://www.rug.nl/ggdc/productivity/pwt/>), which covers 183 countries. When none of the above sources are available, Gapminder falls back on its own historical estimates, primarily from GDP Per capita v26 and earlier versions (<https://www.gapminder.org/documentation/documentation/gapdoc001_v9.pdf>). Additionally, Gapminder has produced new estimates for countries experiencing crises, including Afghanistan, Belarus, Cuba, North Korea, and others (these data points may be less accurate). The various sources were combined and cleaned for GapMinder. 

The second dataset is where the sustainable development index was sourced from. The response variable we were interested in is the Sustainable Development Index (<http://gapm.io/dsdi>) from 1990-2019. The Sustainable Development Index is a research project focused on the ecological efficiency of nations in delivering human development. The data was somewhat cleaned/split into different categories and then posted to GapMinder (https://www.sustainabledevelopmentindex.org/methods).


```{r}
sustainability <- read_csv("sdi.csv")
#164 countries, 1990 - 2019

gdp <- read_csv("gdp_pcap.csv")
#195 countries, 1800 - 2100
```

# 2. Data Cleaning

```{r}
#helper function for values formatted as ex: "1.1k"
convert_k_to_numeric <- function(x) {
  x <- gsub("k", "e3", x)
  as.numeric(x)
}


#pivot longer (each row identified by a country and a year)
sustainability.long <- sustainability |> 
  mutate(across(.cols = '1990':'2019', .fns = ~as.numeric(.x, na.rm = TRUE))) |> 
  pivot_longer(cols = '1990':'2019', 
               names_to = "year", 
               values_to = "sdi")

gdp_long <- gdp |> 
  mutate(across(.cols = '1800':'2100', .fns = ~convert_k_to_numeric(.x))) |> 
  pivot_longer(cols = '1800':'2100', 
               names_to = "year", 
               values_to = "gdp")

#left_join and removing rows missing sdi or gdp
df.clean <- sustainability.long |> 
  left_join(gdp_long, join_by(country, year)) |> 
  filter(!if_any(.cols = sdi:gdp, .fns = ~is.na(.x))) |> 
  mutate(year = as.numeric(year))

str(df.clean)
```


```{r}
df.clean |> 
  group_by(country) |> 
  summarize(across(.cols = year:gdp, 
                   .fns = ~range(.x)), 
           across(.cols = year:gdp, 
                   .fns = ~paste(.x, collapse = "-"))) |> 
  unique() |> 
  kable(col.names = c("Country", "Year Range", "SDI Range", "GDP Range")) |> 
  kable_styling(bootstrap_options = "striped")
  
```


Our dataset includes four variables (Country, Year, SDI and GDP) with a total of 2,306 observations. Note that each observation is identified by a country and year (e.g. Ethiopia, 2018).

We excluded observations missing SDI or GDP data, as these missing values occurred due to the datasets covering additional years not present in the other. For example, the SDI dataset covered only 1990–2019, whereas the GDP dataset spaned 1800–2100. Therefore, GDP values exist for years where SDI data does not, and vice versa. 

The GDP dataset included hypothetical data until the year 2100. We did not want to focus on hypothetical data for this report and we wanted to ensure consistency across datasets. Therefore, we did not include any years past 2019 and before 1990. When the GDP and SDI datasets were combined we constrained the data to match the years in the SDI dataset. 

When data cleaning, removing missing SDI or GDP data mainly affected small or politically unstable countries including: Angola, Antigua, Bhutan, Eritria, Lebanon, Nigeria, Serbia, Suriname, Turkmenistan, and Vanatu. Important to note, Belarus and North Korea were not included in the data at all.

# 3. Modeling and Relationship Between Sustainability (SDI) and GDP per capita

## 2.1 Data Visualization

1.  The relationship between the two quantitative variables you are investigating

```{r}
#preliminary scatterplot
df.clean |> 
  group_by(country) |> 
  summarize(mean.sdi = mean(sdi), mean.gdp = mean(gdp)) |>
  mutate(gdp_class = case_when(mean.gdp >= 20000 ~ "high_gdp",
                        TRUE ~ "low_gdp")|>
  ggplot(aes(x = log(mean.gdp), y = mean.sdi)) +
  geom_point() + facet_grid(~gdp_class) +
  geom_smooth(method = "lm") +
  theme_minimal() +
  labs(x = "GDP per Capita (2017 dollars)", y = "", subtitle = "Sustainable Development Index (SDI)", title = "Relationship between GDP per capita and Sustainability (SDI) \n from 1990 to 2019")
  
```
```{r}
df.clean |> 
  group_by(country) |> 
  summarize(mean.sdi = mean(sdi), mean.gdp = mean(gdp)) |>
  filter(mean.gdp > 20000) |>
  ggplot(aes(x = mean.gdp, y = mean.sdi)) +
  geom_point()+
  geom_smooth(method = "lm") +
  theme_minimal() +
  labs(x = "GDP per Capita (2017 dollars)", y = "", subtitle = "Sustainable Development Index (SDI) of High GDP Countries", title = "Relationship between GDP per capita and Sustainability (SDI) \n from 1990 to 2019")
  



```
```{r}
#Residuals vs Fitted
df.lm <- df.clean|>
  group_by(country) |>
  filter(mean(gdp) > 20000)|>
  summarize (mean.sdi = mean(sdi), 
             mean.gdp = mean(gdp))

lm.fit <- lm(data = df.lm, mean.sdi ~ mean.gdp)

lm.fit |> 
  augment() |> 
  ggplot(aes(x = .fitted, y = .resid)) +
  geom_point() +
  geom_hline(yintercept = 0, linetype = "dashed", 
             color = "red", lwd = 1.5)
```
2.  How this relationship (from #1) has changed over time using an animated plot.

```{r}
df.clean |> 
  group_by(country) |>
  filter(mean(gdp) > 20000) |>
  ungroup() |>
  mutate(year = as.integer(year)) |> #prevents decimal places in subtitle
  ggplot(aes(x = gdp, y = sdi))+
  geom_point()+
  geom_smooth(method = "lm")+
  transition_time(year)+
  ease_aes('linear')+
  theme_minimal() +
  labs(x = "GDP per Capita (2017 dollars)", 
  y = "Sustainable Development Index (SDI)", 
  subtitle = "Year: {frame_time}",
  title = "Change over time in the relationship between GDP per capita and \n sustainability (SDI) from 1990 to 2019")+
  theme(plot.title = element_text(size = 14, margin = margin(t = 20)))
```

## 2.2. Linear Regression

```{r}
df.clean.model <- df.clean |> 
  group_by(country) |> 
  summarize(mean.sdi = mean(sdi), mean.gdp = mean(gdp)) |>
  filter(mean.gdp > 20000)

lm.model <- lm(mean.sdi ~ mean.gdp, data = df.model)

summary(lm.model) |> 
  tidy() |> 
  mutate(p.value = pvalue(p.value)) |> #reformatting p-values (<0.001)
  kable(digits = 5, 
        col.names = c("Term", "Estimate", "Standard Error", "Statistic", "P-value"),
  caption = "Linear regression model for the relationship between \n average sustainability (SDI) and average Gross Domestic Product (GDP) from 1990 to 2019") |>
  kable_material()
```

Citation for formatting p-values using Scales package: <https://scales.r-lib.org/reference/label_pvalue.html>

### Diagnostics

```{r}
#linear relationship

#Independent observations
#yes

#Nortmally distributed residuals
ggplot(data = lm.model,
       aes(x = .resid))+
  geom_histogram(aes(y = after_stat(density)))+
  geom_density(color = "dodgerblue", 
               lwd = 1.5)+
  xlab("Residuals")

#Equal variance of residuals

lm.model |> 
  augment() |> 
  ggplot(aes(x =.fitted,
             y = .resid))+
  geom_point() +
  geom_hline(yintercept = 0, linetype = "dashed", 
             color = "red", lwd = 1.5)
```

## 2.3 Model Fit

```{r}
lm.model |> 
  glance() |> 
  kable() |> 
  kable_material()

total.variance <- var(df.clean.model$mean.sdi)
fitted.variance <- var(fitted(lm.model))
R2 <- fitted.variance/total.variance

model.fit <- c(total.variance, fitted.variance, R2) |> 
  as.data.frame() |> 
  rename(value = "c(total.variance, fitted.variance, R2)") |> 
  mutate(name = c("Total Variance", "Fitted Variance", "R2")) |> 
  pivot_wider(names_from = name, 
              values_from = value) |> 
  kable(digits = 3, 
        caption = "Model fit") |> 
  kable_material()
```

# 4. Cross-Validation

```{r}

```

# 5. Conclusion

```{r}

```

# 6. Works Cited


