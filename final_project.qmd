---
title: "Relationship Between Sustainability (SDI) and GDP per Capita"
author: "Karisa Kopecek, Theo Sprouse, Treasure Joyce & Brooke Wallasch"
format: 
  html:
    embed-resources: true
    code-tools: true
    toc: true
    html-table-processing: none
editor: source
execute: 
  error: true
  echo: true
  message: false
  warning: false
---

# 1. Introduction

## Hypothesis

**Countries with higher GDP will have higher sustainability scores. There is a positive correlation between country wealth and sustainability score of countries.**

We came up with this hypothesis based on news articles we have seen throughout various websites stating things like "How the rich are driving climate change**" (**<https://www.bbc.com/future/article/20211025-climate-how-to-make-the-rich-pay-for-their-carbon-emissions>) which often leads into more articles talking about whether the rich have a responsibility to pay for climate efforts (<https://www.globalcitizen.org/en/content/international-climate-finance-explainer/>). We eventually came across an article talking about how richer countries actually have a bigger gap in marine sustainability efforts compared to poorer countries (<https://www.earth.com/news/wealthy-nations-are-making-more-progress-toward-sustainable-development/>). Additionally, we found that some of the leading countries in sustainability efforts across governance, environmental and social companies include Denmark, Finland, Sweden and Norway which are all countries that are developed countries versus some of the lowest being Burkina Faso, Guinea, and Ethiopia which are developing nations (https://www.robeco.com/en-us/sustainable-investing/expertise/most-sustainable-countries-in-the-world). Overall, we were motivated to see whether richer countries do actually receive higher sustainability scores.

## Objectives

1.  Analyze the relationship between GDP and sustainability scores across different countries

2.  Evaluate outliers in the data

3.  Ultimately asses whether sustainability outcomes are better or worse depending on a country's GDP

## Packages

```{r}
library(tidyverse)
library(knitr)
library(kableExtra)
library(gganimate) 
library(broom) 
library(scales) #for formatting p-values
```

## Data

We extracted two datasets from GapMinder on May 20, 2025.

**Explanatory Variable:** GDP per Capita (<http://gapm.io/dgdpcap_cppp>) from 1800-2022

**Response Variable:** Sustainable Development Index (<http://gapm.io/dsdi>) from 1990-2019

*The original data for GDP per Capita came from:*

For 1990-2022, the series aligns with the World Bank’s GDP per capita data (<https://data.worldbank.org/indicator/NY.GDP.PCAP.PP.KD>), published in April 2024. Prior to 1990, data is drawn from the 2023 version of the Maddison Project Database (<https://www.rug.nl/ggdc/historicaldevelopment/maddison/releases/maddison-project-database-2023>), which offers historical GDP estimates for 169 countries. In rare cases where neither source provided data (typically between 1950-2019) Gapminder uses the Penn World Table (PWT) version 10.01 (<https://www.rug.nl/ggdc/productivity/pwt/>), which covers 183 countries. When none of the above sources are available, Gapminder falls back on its own historical estimates, primarily from GDP Per capita v26 and earlier versions (<https://www.gapminder.org/documentation/documentation/gapdoc001_v9.pdf>). Additionally, Gapminder has produced new estimates for countries experiencing crises, including Afghanistan, Belarus, Cuba, North Korea, and others (these data points may be less accurate). The various sources were combined and cleaned for GapMinder.

*The original data for Sustainable Development Index came from:*

<https://www.sustainabledevelopmentindex.org/methods> which is a research project focused on the ecological efficiency of nations in delivering human development. The data was somewhat cleaned/split into different categories and then posted to GapMinder.

```{r}
sustainability <- read_csv("sdi.csv")
#164 countries, 1990 - 2019

gdp <- read_csv("gdp_pcap.csv")
#195 countries, 1800 - 2100
```

# 2. Data Cleaning

```{r}
#helper function for values formatted as ex: "1.1k"
convert_k_to_numeric <- function(x) {
  x <- gsub("k", "e3", x)
  as.numeric(x)
}


#pivot longer (each row identified by a country and a year)
sustainability.long <- sustainability |> 
  mutate(across(.cols = '1990':'2019', .fns = ~as.numeric(.x, na.rm = TRUE))) |> 
  pivot_longer(cols = '1990':'2019', 
               names_to = "year", 
               values_to = "sdi")

gdp_long <- gdp |> 
  mutate(across(.cols = '1800':'2100', .fns = ~convert_k_to_numeric(.x))) |> 
  pivot_longer(cols = '1800':'2100', 
               names_to = "year", 
               values_to = "gdp")

#left_join and removing rows missing sdi or gdp
df.clean <- sustainability.long |> 
  left_join(gdp_long, join_by(country, year)) |> 
  filter(!if_any(.cols = sdi:gdp, .fns = ~is.na(.x))) |> 
  mutate(year = as.numeric(year))

str(df.clean)
```

**Dataset Description:**

Our dataset includes four columns (Country, Year, SDI and GDP) with 2,306 observations. Each observation is identified by a country and year (e.g. Ethiopia, 2018).

```{r}
df.clean |> 
  group_by(country) |> 
  summarize(across(.cols = year:gdp, 
                   .fns = ~range(.x)), 
           across(.cols = year:gdp, 
                   .fns = ~paste(.x, collapse = "-"))) |> 
  unique() |> 
  kable(col.names = c("Country", "Year Range", "SDI Range", "GDP Range")) |> 
  kable_styling(bootstrap_options = "striped")
  
```

**Data cleaning process and decisions that may impact the analysis:**

We dropped rows missing sdi or gdp data, and these missing values likely occurred due to the SDI dataset covering only 1990–2019, whereas the GDP dataset spans 1800–2100. So, GDP values may exist for years where SDI data does not, and vice versa. The GDP dataset included hypothetical data until the year 2100. We did not want to focus on any hypothetical data and we wanted to ensure consistency across datasets and therefore did not include any years past 2019 and before 1990. When the GDP and SDI datasets were joined we constrained the data to match the years in the SDI dataset.

Also, data cleaning removing missing sdi or gdp data mainly affected small or politically unstable countries including: Angola, Antigua, Bhutan, Eritria, Lebanon, Nigeria, Serbia, Suriname, Turkmenistan, and Vanatu (Belarus, North Korea not included at all in the data).

\*The following is not included in this week's report, but we included it for future reference

# 3. Modeling and Relationship Between Sustainability (SDI) and GDP per capita

## 2.1 Data Visualization

1.  The relationship between the two quantitative variables you are investigating

```{r}
#preliminary scatterplot
df.clean |> 
  group_by(country) |> 
  summarize(mean.sdi = mean(sdi), mean.gdp = mean(gdp)) |> 
  ggplot(aes(x = mean.gdp, y = mean.sdi))+
  geom_point()+
  geom_smooth(method = "lm")+
  theme_minimal() +
  labs(x = "GDP per Capita (2017 dollars)", y = "", subtitle = "Sustainable Development Index (SDI)", title = "Relationship between GDP per capita and Sustainability (SDI) \n from 1990 to 2019")
  
```

2.  How this relationship (from #1) has changed over time using an animated plot.

```{r}
df.clean |> 
  mutate(year = as.integer(year)) |> #prevents decimal places in subtitle
  ggplot(aes(x = gdp, y = sdi))+
  geom_point()+
  geom_smooth(method = "lm")+
  transition_time(year)+
  ease_aes('linear')+
  theme_minimal() +
  labs(x = "GDP per Capita (2017 dollars)", 
  y = "Sustainable Development Index (SDI)", 
  subtitle = "Year: {frame_time}",
  title = "Change over time in the relationship between GDP per capita and \n sustainability (SDI) from 1990 to 2019")+
  theme(plot.title = element_text(size = 14, margin = margin(t = 20)))
```

## 2.2. Linear Regression

```{r}
df.model <- df.clean |> 
  group_by(country) |> 
  summarize(mean.sdi = mean(sdi), mean.gdp = mean(gdp))

results <- lm(mean.sdi ~ mean.gdp, data = df.model)

summary(results) |> 
  tidy() |> 
  mutate(p.value = pvalue(p.value)) |> #reformatting p-values (<0.001)
  kable(digits = 5, 
        col.names = c("Term", "Estimate", "Standard Error", "Statistic", "P-value"),
  caption = "Linear regression model for the relationship between \n average sustainability (SDI) and average Gross Domestic Product (GDP) from 1990 to 2019") |>
  kable_material()
```

Citation for formatting p-values using Scales package: <https://scales.r-lib.org/reference/label_pvalue.html>

## 2.3 Model Fit

```{r}
results |> 
  glance() |> 
  kable() |> 
  kable_material()

total.variance <- var(df.model$mean.sdi)
fitted.variance <- var(fitted(results))
R2 <- fitted.variance/total.variance

model.fit <- c(total.variance, fitted.variance, R2) |> 
  as.data.frame() |> 
  rename(value = "c(total.variance, fitted.variance, R2)") |> 
  mutate(name = c("Total Variance", "Fitted Variance", "R2")) |> 
  pivot_wider(names_from = name, 
              values_from = value) |> 
  kable(digits = 3, 
        caption = "Model fit") |> 
  kable_material()
```

# 4. Cross-Validation

```{r}

```

# 5. Conclusion

```{r}

```

# 6. Works Cited
